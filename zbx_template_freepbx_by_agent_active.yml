zabbix_export:
  version: '5.4'
  date: '2024-10-17T17:54:35Z'
  groups:
    -
      uuid: 1d12408342854fd5a4436dd6d5d1bd4a
      name: Templates/Telephony
  templates:
    -
      uuid: 30cc187a4e994c39b07f53d86b5cc6bc
      template: 'Template Tel Asterisk-FreePBX by Agent-Active'
      name: 'Template Tel Asterisk-FreePBX by Agent-Active'
      description: |
        The template gets Asterisk and FreePBX metrics from Zabbix Agent installed on the FreePBX server calling a custom PHP script.
        
        Place zabbix-stats.php in a location accessible to Zabbix agent.
        
        Be sure the zabbix agent config defines this UserParameter:
        
        UserParameter=asterisk.get_stats,/path/to/zabbix-stats.php
      groups:
        -
          name: Templates/Telephony
      items:
        -
          uuid: 72d074f6bb214ef9884d8cc4b1530ad3
          name: 'Asterisk: Active calls'
          type: DEPENDENT
          key: asterisk.active_calls
          delay: '0'
          history: 7d
          description: 'The number of active calls at the moment.'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.active_calls
          master_item:
            key: asterisk.get_stats
          tags:
            -
              tag: Application
              value: Asterisk
        -
          uuid: bb9ac1ac188b43239456477e13ae555f
          name: 'Asterisk: Active channels'
          type: DEPENDENT
          key: asterisk.active_channels
          delay: '0'
          history: 7d
          description: 'The number of active channels at the moment.'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.active_channels
          master_item:
            key: asterisk.get_stats
          tags:
            -
              tag: Application
              value: Asterisk
        -
          uuid: ccfc2a8a5880430196e2c874b66370ca
          name: 'Asterisk: Calls processed'
          type: DEPENDENT
          key: asterisk.calls_processed
          delay: '0'
          history: 7d
          description: 'The number of calls processed after the last service restart.'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.calls_processed
          master_item:
            key: asterisk.get_stats
          tags:
            -
              tag: Application
              value: Asterisk
        -
          uuid: 196af875a190438abd8de5a6803a550f
          name: 'Asterisk: Calls processed per second'
          type: DEPENDENT
          key: asterisk.calls_processed.rate
          delay: '0'
          history: 7d
          value_type: FLOAT
          description: 'The number of calls processed per second.'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.calls_processed
            -
              type: CHANGE_PER_SECOND
              parameters:
                - ''
          master_item:
            key: asterisk.get_stats
          tags:
            -
              tag: Application
              value: Asterisk
        -
          uuid: ddb27b085ea1442c8d36fabc940d8083
          name: 'Asterisk: FreePBX license'
          type: DEPENDENT
          key: asterisk.freepbx_license
          delay: '0'
          history: 7d
          trends: '0'
          value_type: TEXT
          inventory_link: SOFTWARE_FULL
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.license_file
            -
              type: TRIM
              parameters:
                - '[]'
            -
              type: STR_REPLACE
              parameters:
                - ','
                - \n
          master_item:
            key: asterisk.get_stats
          tags:
            -
              tag: Application
              value: Asterisk
        -
          uuid: bfa670508d2f4eccb034c78e7795e4bb
          name: 'Asterisk: FreePBX Version'
          type: DEPENDENT
          key: asterisk.freepbx_version
          delay: '0'
          history: 7d
          trends: '0'
          value_type: CHAR
          description: 'FreePBX version'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.freepbx_version
          master_item:
            key: asterisk.get_stats
          tags:
            -
              tag: Application
              value: Asterisk
            -
              tag: Application
              value: 'Dashboard Overview'
        -
          uuid: 7db3e9cdae3d4bffa7429617e351fce1
          name: 'Asterisk: Get stats'
          type: ZABBIX_ACTIVE
          key: asterisk.get_stats
          history: '0'
          trends: '0'
          value_type: TEXT
          description: 'Asterisk system information in JSON format.'
          tags:
            -
              tag: Application
              value: 'Zabbix raw items'
        -
          uuid: d9900a1f096a4b89a2aa4af89f30b2cc
          name: 'Asterisk: IAX trunks active channels'
          type: DEPENDENT
          key: asterisk.iax.active_channels
          delay: '0'
          history: 7d
          description: 'The total number of IAX trunks active channels.'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.iax.active_channels
          master_item:
            key: asterisk.get_stats
          tags:
            -
              tag: Application
              value: Asterisk
          triggers:
            -
              uuid: 0ae0a5b6123a42dd9722219e5e5839df
              expression: 'min(/Template Tel Asterisk-FreePBX by Agent-Active/asterisk.iax.active_channels,10m)>={$AMI.TRUNK_ACTIVE_CHANNELS_TOTAL.MAX.WARN:"IAX"}'
              name: 'Asterisk: Total number of active channels of IAX trunks is too high (over {$AMI.TRUNK_ACTIVE_CHANNELS_TOTAL.MAX.WARN:"IAX"} for 10m)'
              priority: WARNING
              description: 'The IAX trunks may not be able to process new calls.'
        -
          uuid: 0798cf46d82041e6a7091698c7693ec5
          name: 'Asterisk: IAX offline peers'
          type: DEPENDENT
          key: asterisk.iax.offline
          delay: '0'
          history: 7d
          description: 'The number of offline IAX peers.'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.iax.offline
          master_item:
            key: asterisk.get_stats
          tags:
            -
              tag: Application
              value: Asterisk
        -
          uuid: bf741f5560734530be352341071c5984
          name: 'Asterisk: IAX online peers'
          type: DEPENDENT
          key: asterisk.iax.online
          delay: '0'
          history: 7d
          description: 'The number of online IAX peers.'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.iax.online
          master_item:
            key: asterisk.get_stats
          tags:
            -
              tag: Application
              value: Asterisk
        -
          uuid: ccb62e9b41da4f20b4ab19e4eecd598b
          name: 'Asterisk: IAX peers'
          type: DEPENDENT
          key: asterisk.iax.total
          delay: '0'
          history: 7d
          description: 'The total number of IAX peers.'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.iax.total
          master_item:
            key: asterisk.get_stats
          tags:
            -
              tag: Application
              value: Asterisk
        -
          uuid: cf5c07c1a09b4a10af21292b876fcb20
          name: 'Asterisk: IAX unmonitored peers'
          type: DEPENDENT
          key: asterisk.iax.unmonitored
          delay: '0'
          history: 7d
          description: 'The number of unmonitored IAX peers.'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.iax.unmonitored
          master_item:
            key: asterisk.get_stats
          tags:
            -
              tag: Application
              value: Asterisk
        -
          uuid: eeadb3e87f7c46e4a6264fecd8552349
          name: 'Asterisk: Mail queued'
          type: DEPENDENT
          key: asterisk.mail_queued
          delay: '0'
          history: 7d
          description: 'Mail queued on the server, if using postfix'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.mail_queued
          master_item:
            key: asterisk.get_stats
          tags:
            -
              tag: Application
              value: Asterisk
          triggers:
            -
              uuid: a1d2dd4b5b0b4f0995b5d79961bcbd23
              expression: 'last(/Template Tel Asterisk-FreePBX by Agent-Active/asterisk.mail_queued)>=5'
              name: 'Asterisk: mail broken'
              priority: AVERAGE
            -
              uuid: 306ee000abef4fd59895bec60a81c519
              expression: 'last(/Template Tel Asterisk-FreePBX by Agent-Active/asterisk.mail_queued)>=2'
              name: 'Asterisk: Mail queued'
              priority: WARNING
        -
          uuid: 5ae6135a49764db7b496f5d2378ddd77
          name: 'Asterisk: PJSIP trunks active channels'
          type: DEPENDENT
          key: asterisk.pjsip.active_channels
          delay: '0'
          history: 7d
          description: 'The total number of PJSIP trunks active channels.'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.pjsip.active_channels
          master_item:
            key: asterisk.get_stats
          tags:
            -
              tag: Application
              value: Asterisk
          triggers:
            -
              uuid: 9b158fe0efb4416cb6ad5d53b38c3e38
              expression: 'min(/Template Tel Asterisk-FreePBX by Agent-Active/asterisk.pjsip.active_channels,10m)>={$AMI.TRUNK_ACTIVE_CHANNELS_TOTAL.MAX.WARN:"PJSIP"}'
              name: 'Asterisk: Total number of active channels of PJSIP trunks is too high (over {$AMI.TRUNK_ACTIVE_CHANNELS_TOTAL.MAX.WARN:"PJSIP"} for 10m)'
              priority: WARNING
              description: 'The PJSIP trunks may not be able to process new calls.'
        -
          uuid: cc07f186104842aabec3d26dcd4322d2
          name: 'Asterisk: PJSIP available endpoints'
          type: DEPENDENT
          key: asterisk.pjsip.available
          delay: '0'
          history: 7d
          description: 'The number of available PJSIP peers.'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.pjsip.available
          master_item:
            key: asterisk.get_stats
          tags:
            -
              tag: Application
              value: Asterisk
        -
          uuid: fdc888cb355a4b738be8a77354a7ce76
          name: 'Asterisk: PJSIP endpoints'
          type: DEPENDENT
          key: asterisk.pjsip.total
          delay: '0'
          history: 7d
          description: 'The total number of PJSIP peers.'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.pjsip.total
          master_item:
            key: asterisk.get_stats
          tags:
            -
              tag: Application
              value: Asterisk
        -
          uuid: 5c10fe1a4bfb4628be20137d0f1ec725
          name: 'Asterisk: PJSIP unavailable endpoints'
          type: DEPENDENT
          key: asterisk.pjsip.unavailable
          delay: '0'
          history: 7d
          description: 'The number of unavailable PJSIP peers.'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.pjsip.unavailable
          master_item:
            key: asterisk.get_stats
          tags:
            -
              tag: Application
              value: Asterisk
        -
          uuid: 2df0dca89a744e86b4f5a2cec673d427
          name: 'Asterisk: SIP trunks active channels'
          type: DEPENDENT
          key: asterisk.sip.active_channels
          delay: '0'
          history: 7d
          description: 'The total number of SIP trunks active channels.'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.sip.active_channels
          master_item:
            key: asterisk.get_stats
          tags:
            -
              tag: Application
              value: Asterisk
          triggers:
            -
              uuid: d2fde5d26d284a129346a12ba0949b60
              expression: 'min(/Template Tel Asterisk-FreePBX by Agent-Active/asterisk.sip.active_channels,10m)>={$AMI.TRUNK_ACTIVE_CHANNELS_TOTAL.MAX.WARN:"SIP"}'
              name: 'Asterisk: Total number of active channels of SIP trunks is too high (over {$AMI.TRUNK_ACTIVE_CHANNELS_TOTAL.MAX.WARN:"SIP"} for 10m)'
              priority: WARNING
              description: 'The SIP trunks may not be able to process new calls.'
        -
          uuid: fb08ec8d143a41a097f8652c8261bad8
          name: 'Asterisk: SIP monitored offline'
          type: DEPENDENT
          key: asterisk.sip.monitored_offline
          delay: '0'
          history: 7d
          description: 'The number of monitored offline SIP peers.'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.sip.monitored_offline
          master_item:
            key: asterisk.get_stats
          tags:
            -
              tag: Application
              value: Asterisk
        -
          uuid: 23744b0a04b54637a7dbe1c7f8f5200f
          name: 'Asterisk: SIP monitored online'
          type: DEPENDENT
          key: asterisk.sip.monitored_online
          delay: '0'
          history: 7d
          description: 'The number of monitored online SIP peers.'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.sip.monitored_online
          master_item:
            key: asterisk.get_stats
          tags:
            -
              tag: Application
              value: Asterisk
        -
          uuid: fb78998a342942ac942a7e1632b98208
          name: 'Asterisk: SIP peers'
          type: DEPENDENT
          key: asterisk.sip.total
          delay: '0'
          history: 7d
          description: 'The total number of SIP peers.'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.sip.total
          master_item:
            key: asterisk.get_stats
          tags:
            -
              tag: Application
              value: Asterisk
        -
          uuid: ae21f8c13063402d9eece400a18c6167
          name: 'Asterisk: SIP unmonitored offline'
          type: DEPENDENT
          key: asterisk.sip.unmonitored_offline
          delay: '0'
          history: 7d
          description: 'The number of unmonitored offline SIP peers.'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.sip.unmonitored_offline
          master_item:
            key: asterisk.get_stats
          tags:
            -
              tag: Application
              value: Asterisk
        -
          uuid: 1cd5fb5232ca4f4398f85d959ac11b2c
          name: 'Asterisk: SIP unmonitored online'
          type: DEPENDENT
          key: asterisk.sip.unmonitored_online
          delay: '0'
          history: 7d
          description: 'The number of unmonitored online SIP peers.'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.sip.unmonitored_online
          master_item:
            key: asterisk.get_stats
          tags:
            -
              tag: Application
              value: Asterisk
        -
          uuid: 9c64cb54c2c541c1862558dcf8c6e3a3
          name: 'Asterisk: Total queues'
          type: DEPENDENT
          key: asterisk.total_queues
          delay: '0'
          history: 7d
          description: 'The number of configured queues.'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.queue.total
          master_item:
            key: asterisk.get_stats
          tags:
            -
              tag: Application
              value: Asterisk
        -
          uuid: 8395ab5b70a7433eb508c513995988bb
          name: 'Asterisk: Uptime'
          type: DEPENDENT
          key: asterisk.uptime
          delay: '0'
          history: 7d
          value_type: FLOAT
          units: uptime
          description: 'System uptime in ''N days, hh:mm:ss'' format.'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.uptime
          master_item:
            key: asterisk.get_stats
          tags:
            -
              tag: Application
              value: Asterisk
            -
              tag: Application
              value: 'Dashboard Overview'
          triggers:
            -
              uuid: 35ca01e504a548db9d4db8be1390d6b9
              expression: 'nodata(/Template Tel Asterisk-FreePBX by Agent-Active/asterisk.uptime,30m)=1'
              name: 'Asterisk: Failed to fetch from AMI (or no data for 30m)'
              priority: WARNING
              description: 'Zabbix has not received data for items for the last 30 minutes.'
              manual_close: 'YES'
              dependencies:
                -
                  name: 'Asterisk: Service is down'
                  expression: 'last(/Template Tel Asterisk-FreePBX by Agent-Active/proc.num[asterisk])=0'
            -
              uuid: 100d38b62c1d4ce298a9fadfbab19e4c
              expression: 'last(/Template Tel Asterisk-FreePBX by Agent-Active/asterisk.uptime)<10m'
              name: 'Asterisk: has been restarted (uptime < 10m)'
              priority: INFO
              description: 'Uptime is less than 10 minutes'
              manual_close: 'YES'
        -
          uuid: 86e23b5b9fd64e6e840588d25921fcbf
          name: 'Asterisk: Uptime after reload'
          type: DEPENDENT
          key: asterisk.uptime_reload
          delay: '0'
          history: 7d
          value_type: FLOAT
          units: uptime
          description: 'System uptime after a config reload in ''N days, hh:mm:ss'' format.'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.uptime_reload
          master_item:
            key: asterisk.get_stats
          tags:
            -
              tag: Application
              value: Asterisk
            -
              tag: Application
              value: 'Dashboard Overview'
          triggers:
            -
              uuid: 4e99b65188264ba1aa80e24662f9b3cd
              expression: 'last(/Template Tel Asterisk-FreePBX by Agent-Active/asterisk.uptime_reload)<10m'
              name: 'Asterisk: has been reloaded (uptime < 10m)'
              status: DISABLED
              priority: INFO
              description: 'Uptime is less than 10 minutes'
              manual_close: 'YES'
        -
          uuid: 8ed124c5d61541c0ab1dcc3491fb05c6
          name: 'Asterisk: Version'
          type: DEPENDENT
          key: asterisk.version
          delay: '0'
          history: 7d
          trends: '0'
          value_type: CHAR
          description: 'Service version'
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.version
          master_item:
            key: asterisk.get_stats
          tags:
            -
              tag: Application
              value: Asterisk
            -
              tag: Application
              value: 'Dashboard Overview'
          triggers:
            -
              uuid: f1a260626ae6446d89e1e725e14c1098
              expression: '(last(/Template Tel Asterisk-FreePBX by Agent-Active/asterisk.version,#1)<>last(/Template Tel Asterisk-FreePBX by Agent-Active/asterisk.version,#2))=1 and length(last(/Template Tel Asterisk-FreePBX by Agent-Active/asterisk.version))>0'
              name: 'Asterisk: Version has changed (new version: {ITEM.VALUE})'
              priority: INFO
              description: 'Asterisk version has changed. Ack to close.'
              manual_close: 'YES'
        -
          uuid: 09102393dc6a4ac598f02d95801c6ca0
          name: 'Asterisk: Service response time'
          type: ZABBIX_ACTIVE
          key: 'net.tcp.service.perf[tcp,127.0.0.1,5038]'
          history: 7d
          value_type: FLOAT
          units: s
          description: 'Asterisk Manager API performance.'
          tags:
            -
              tag: Application
              value: Asterisk
          triggers:
            -
              uuid: dbc74502be01498194003dc1a3d90014
              expression: 'min(/Template Tel Asterisk-FreePBX by Agent-Active/net.tcp.service.perf[tcp,127.0.0.1,5038],5m)>{$AMI.RESPONSE_TIME.MAX.WARN}'
              name: 'Asterisk: Service response time is too high (over {$AMI.RESPONSE_TIME.MAX.WARN} for 5m)'
              priority: WARNING
              manual_close: 'YES'
              dependencies:
                -
                  name: 'Asterisk: Service is down'
                  expression: 'last(/Template Tel Asterisk-FreePBX by Agent-Active/proc.num[asterisk])=0'
        -
          uuid: 58e18df6a5534395bf74d3babdb73170
          name: 'Asterisk: Service status'
          type: ZABBIX_ACTIVE
          key: 'proc.num[asterisk]'
          history: 7d
          description: 'Asterisk Manager API port avalability.'
          valuemap:
            name: 'Service state'
          preprocessing:
            -
              type: IN_RANGE
              parameters:
                - '0'
                - '1'
              error_handler: CUSTOM_ERROR
              error_handler_params: UNKNOWN
          tags:
            -
              tag: Application
              value: Asterisk
          triggers:
            -
              uuid: 1fa3370fa93f4d07a2c470f993096554
              expression: 'last(/Template Tel Asterisk-FreePBX by Agent-Active/proc.num[asterisk])=0'
              name: 'Asterisk: Service is down'
              priority: AVERAGE
              manual_close: 'YES'
      discovery_rules:
        -
          uuid: 3e7facc25a344cec8e384e8a9f8b372a
          name: 'IAX peers discovery'
          type: DEPENDENT
          key: asterisk.iax_peers.discovery
          delay: '0'
          item_prototypes:
            -
              uuid: 72d71ec4fa2b4e88a03d25e3bbe8771a
              name: 'IAX trunk "{#OBJECTNAME}": Active channels'
              type: DEPENDENT
              key: 'asterisk.iax.trunk.active_channels[{#OBJECTNAME}]'
              delay: '0'
              history: 7d
              description: 'The total number of active IAX trunk channels.'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$.iax.trunks[?(@.ObjectName==''{#OBJECTNAME}'')].active_channels.first()'
              master_item:
                key: asterisk.get_stats
              tags:
                -
                  tag: Application
                  value: 'Asterisk IAX trunks'
              trigger_prototypes:
                -
                  uuid: e2a6c7a9b6234e2aae20c9aa480f9ef1
                  expression: 'min(/Template Tel Asterisk-FreePBX by Agent-Active/asterisk.iax.trunk.active_channels[{#OBJECTNAME}],10m)>={$AMI.TRUNK_ACTIVE_CHANNELS.MAX.WARN:"{#OBJECTNAME}"}'
                  name: 'IAX trunk "{#OBJECTNAME}": Number of the IAX trunk "{#OBJECTNAME}" active channels is too high (over {$AMI.TRUNK_ACTIVE_CHANNELS.MAX.WARN:"{#OBJECTNAME}"} for 10m)'
                  priority: WARNING
                  description: 'The IAX trunk may not be able to process new calls.'
            -
              uuid: bbde7e898b4b4d34b27308d6ddaf86fc
              name: 'IAX trunk "{#OBJECTNAME}": Status'
              type: DEPENDENT
              key: 'asterisk.iax.trunk.status[{#OBJECTNAME}]'
              delay: '0'
              history: 7d
              trends: '0'
              value_type: CHAR
              description: |
                IAX trunk status. Here are the possible states that a device state may have:
                Unmonitored
                UNKNOWN
                UNREACHABLE
                OK
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$.iax.trunks[?(@.ObjectName==''{#OBJECTNAME}'')].Status.first()'
                -
                  type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              master_item:
                key: asterisk.get_stats
              tags:
                -
                  tag: Application
                  value: 'Asterisk IAX trunks'
              trigger_prototypes:
                -
                  uuid: db595245acef4ec9b771c266c14100d2
                  expression: 'last(/Template Tel Asterisk-FreePBX by Agent-Active/asterisk.iax.trunk.status[{#OBJECTNAME}])="UNKNOWN" or last(/Template Tel Asterisk-FreePBX by Agent-Active/asterisk.iax.trunk.status[{#OBJECTNAME}])="UNREACHABLE"'
                  name: 'IAX trunk "{#OBJECTNAME}": IAX trunk {#OBJECTNAME} has a state {ITEM.VALUE}'
                  priority: AVERAGE
                  description: 'The IAX trunk is unable to establish a connection with a neighbor due to network issues or incorrect configuration.'
          master_item:
            key: asterisk.get_stats
          lld_macro_paths:
            -
              lld_macro: '{#OBJECTNAME}'
              path: $.ObjectName
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.iax.trunks
            -
              type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
        -
          uuid: 8103a9cc3f2d46758521138b536148ba
          name: 'PJSIP endpoints discovery'
          type: DEPENDENT
          key: asterisk.pjsip_endpoints.discovery
          delay: '0'
          lifetime: 7d
          item_prototypes:
            -
              uuid: 06f255e763f74fb287cc1b258bf33c52
              name: 'PJSIP endpoint "{#OBJECTNAME}": Device state'
              type: DEPENDENT
              key: 'asterisk.pjsip.endpoint.devicestate[{#OBJECTNAME}]'
              delay: '0'
              history: 7d
              trends: '0'
              value_type: CHAR
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$.pjsip.endpoints[?(@.ObjectName==''{#OBJECTNAME}'')].DeviceState.first()'
                -
                  type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              master_item:
                key: asterisk.get_stats
              tags:
                -
                  tag: Application
                  value: 'Asterisk PJSIP endpoints'
              trigger_prototypes:
                -
                  uuid: 5186e5837ff4446fbe0616be91e8f4ea
                  expression: 'last(/Template Tel Asterisk-FreePBX by Agent-Active/asterisk.pjsip.endpoint.devicestate[{#OBJECTNAME}])="Unavailable"'
                  name: 'Asterisk: PJSIP endpoint {#OBJECTNAME} unavailable'
                  priority: WARNING
          master_item:
            key: asterisk.get_stats
          lld_macro_paths:
            -
              lld_macro: '{#OBJECTNAME}'
              path: $.ObjectName
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.pjsip.endpoints
            -
              type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
        -
          uuid: 1a123ca04c7544bfa823a39b8a9fe84c
          name: 'PJSIP trunks discovery'
          type: DEPENDENT
          key: asterisk.pjsip_trunks.discovery
          delay: '0'
          item_prototypes:
            -
              uuid: ec8220a1aa814112908337a009f6fcac
              name: 'PJSIP trunk "{#OBJECTNAME}": Active channels'
              type: DEPENDENT
              key: 'asterisk.pjsip.trunk.active_channels[{#OBJECTNAME}]'
              delay: '0'
              history: 7d
              description: 'The total number of active PJSIP trunk channels.'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$.pjsip.trunks[?(@.ObjectName==''{#OBJECTNAME}'')].active_channels.first()'
              master_item:
                key: asterisk.get_stats
              tags:
                -
                  tag: Application
                  value: 'Asterisk PJSIP trunks'
              trigger_prototypes:
                -
                  uuid: f192d555011c42c28c6a8f52c0388fe1
                  expression: 'min(/Template Tel Asterisk-FreePBX by Agent-Active/asterisk.pjsip.trunk.active_channels[{#OBJECTNAME}],10m)>={$AMI.TRUNK_ACTIVE_CHANNELS.MAX.WARN:"{#OBJECTNAME}"}'
                  name: 'PJSIP trunk "{#OBJECTNAME}": Number of the PJSIP trunk "{#OBJECTNAME}" active channels is too high (over {$AMI.TRUNK_ACTIVE_CHANNELS.MAX.WARN:"{#OBJECTNAME}"} for 10m)'
                  priority: WARNING
                  description: 'The PJSIP trunk may not be able to process new calls.'
            -
              uuid: c364b2ac50344372b155cbb98d9a7afe
              name: 'PJSIP trunk "{#OBJECTNAME}": Device state'
              type: DEPENDENT
              key: 'asterisk.pjsip.trunk.devicestate[{#OBJECTNAME}]'
              delay: '0'
              history: 7d
              trends: '0'
              value_type: CHAR
              description: |
                PJSIP trunk status. Here are the possible states that a device state may have:
                Unavailable
                Not in use
                In use
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$.pjsip.trunks[?(@.ObjectName==''{#OBJECTNAME}'')].DeviceState.first()'
                -
                  type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              master_item:
                key: asterisk.get_stats
              tags:
                -
                  tag: Application
                  value: 'Asterisk PJSIP trunks'
              trigger_prototypes:
                -
                  uuid: 6f31d886d6954b82874d38646b233689
                  expression: 'last(/Template Tel Asterisk-FreePBX by Agent-Active/asterisk.pjsip.trunk.devicestate[{#OBJECTNAME}])="Unavailable"'
                  name: 'PJSIP trunk "{#OBJECTNAME}": PJSIP trunk {#OBJECTNAME} has a state Unavailable'
                  priority: AVERAGE
                  description: 'The PJSIP trunk is unable to establish a connection with a neighbor due to network issues or incorrect configuration.'
          master_item:
            key: asterisk.get_stats
          lld_macro_paths:
            -
              lld_macro: '{#OBJECTNAME}'
              path: $.ObjectName
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.pjsip.trunks
            -
              type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
        -
          uuid: 5a936a95d62f4b50a4f3db112a3e041f
          name: 'Queues discovery'
          type: DEPENDENT
          key: asterisk.queues.discovery
          delay: '0'
          item_prototypes:
            -
              uuid: c16d9df72ba749369726d4cfcc8b4f40
              name: '"{#QUEUE}": Available'
              type: DEPENDENT
              key: 'asterisk.queue.available[{#QUEUE}]'
              delay: '0'
              history: 7d
              description: 'The number of available queue members.'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$.queue.queues[?(@.Queue==''{#QUEUE}'')].Available.first()'
              master_item:
                key: asterisk.get_stats
              tags:
                -
                  tag: Application
                  value: 'Asterisk queue "{#QUEUE}"'
            -
              uuid: c271c7d76b2e49dea386bb08d60307d0
              name: '"{#QUEUE}": Callers'
              type: DEPENDENT
              key: 'asterisk.queue.callers[{#QUEUE}]'
              delay: '0'
              history: 7d
              description: 'The number incoming calls in queue.'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$.queue.queues[?(@.Queue==''{#QUEUE}'')].Callers.first()'
              master_item:
                key: asterisk.get_stats
              tags:
                -
                  tag: Application
                  value: 'Asterisk queue "{#QUEUE}"'
              trigger_prototypes:
                -
                  uuid: 4f72c6a755be465287f36b8b12d3175b
                  expression: 'min(/Template Tel Asterisk-FreePBX by Agent-Active/asterisk.queue.callers[{#QUEUE}],10m)>{$AMI.QUEUE_CALLERS.MAX.WARN:"{#QUEUE}"}'
                  name: '"{#QUEUE}": Number of callers in the queue "{#QUEUE}" is too high (over {$AMI.QUEUE_CALLERS.MAX.WARN:"{#QUEUE}"} for 10m)'
                  priority: WARNING
                  description: 'There is a large number of calls in the queue.'
            -
              uuid: 8319ec55cf6f4e8590f180f1a81f37ed
              name: '"{#QUEUE}": Logged in'
              type: DEPENDENT
              key: 'asterisk.queue.loggedin[{#QUEUE}]'
              delay: '0'
              history: 7d
              description: 'The number of queue members.'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$.queue.queues[?(@.Queue==''{#QUEUE}'')].LoggedIn.first()'
              master_item:
                key: asterisk.get_stats
              tags:
                -
                  tag: Application
                  value: 'Asterisk queue "{#QUEUE}"'
          master_item:
            key: asterisk.get_stats
          lld_macro_paths:
            -
              lld_macro: '{#QUEUE}'
              path: $.Queue
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.queue.queues
            -
              type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
        -
          uuid: 675fc5b11cb1482db0c539dfb9100e75
          name: 'SIP peers discovery'
          type: DEPENDENT
          key: asterisk.sip_peers.discovery
          delay: '0'
          item_prototypes:
            -
              uuid: 9043578864494b13b249ee7bdf13820d
              name: 'SIP trunk "{#OBJECTNAME}": Active channels'
              type: DEPENDENT
              key: 'asterisk.sip.trunk.active_channels[{#OBJECTNAME}]'
              delay: '0'
              history: 7d
              description: 'The total number of active SIP trunk channels.'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$.sip.trunks[?(@.ObjectName==''{#OBJECTNAME}'')].active_channels.first()'
              master_item:
                key: asterisk.get_stats
              tags:
                -
                  tag: Application
                  value: 'Asterisk SIP trunks'
              trigger_prototypes:
                -
                  uuid: 51820b1326f84f51ba0e561946275133
                  expression: 'min(/Template Tel Asterisk-FreePBX by Agent-Active/asterisk.sip.trunk.active_channels[{#OBJECTNAME}],10m)>={$AMI.TRUNK_ACTIVE_CHANNELS.MAX.WARN:"{#OBJECTNAME}"}'
                  name: 'SIP trunk "{#OBJECTNAME}": Number of the SIP trunk "{#OBJECTNAME}" active channels is too high (over {$AMI.TRUNK_ACTIVE_CHANNELS.MAX.WARN:"{#OBJECTNAME}"} for 10m)'
                  priority: WARNING
                  description: 'The SIP trunk may not be able to process new calls.'
            -
              uuid: df33da749e874f55be5f0c33cd201f62
              name: 'SIP trunk "{#OBJECTNAME}": Status'
              type: DEPENDENT
              key: 'asterisk.sip.trunk.status[{#OBJECTNAME}]'
              delay: '0'
              history: 7d
              trends: '0'
              value_type: CHAR
              description: |
                SIP trunk status. Here are the possible states that a device state may have:
                Unmonitored
                UNKNOWN
                UNREACHABLE
                OK
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$.sip.trunks[?(@.ObjectName==''{#OBJECTNAME}'')].Status.first()'
                -
                  type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              master_item:
                key: asterisk.get_stats
              tags:
                -
                  tag: Application
                  value: 'Asterisk SIP trunks'
              trigger_prototypes:
                -
                  uuid: 39cac88e9263470da6e4b1a08f806c58
                  expression: 'last(/Template Tel Asterisk-FreePBX by Agent-Active/asterisk.sip.trunk.status[{#OBJECTNAME}])="UNKNOWN" or last(/Template Tel Asterisk-FreePBX by Agent-Active/asterisk.sip.trunk.status[{#OBJECTNAME}])="UNREACHABLE"'
                  name: 'SIP trunk "{#OBJECTNAME}": SIP trunk {#OBJECTNAME} has a state {ITEM.VALUE}'
                  priority: AVERAGE
                  description: 'The SIP trunk is unable to establish a connection with a neighbor due to network issues or incorrect configuration.'
          master_item:
            key: asterisk.get_stats
          lld_macro_paths:
            -
              lld_macro: '{#OBJECTNAME}'
              path: $.ObjectName
          preprocessing:
            -
              type: JSONPATH
              parameters:
                - $.sip.trunks
            -
              type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
      macros:
        -
          macro: '{$AMI.QUEUE_CALLERS.MAX.WARN}'
          value: '10'
          description: 'The maximum number of callers in a queue for trigger expression.'
        -
          macro: '{$AMI.RESPONSE_TIME.MAX.WARN}'
          value: 10s
          description: 'The Asterisk Manager API page maximum response time in seconds for trigger expression.'
        -
          macro: '{$AMI.TRUNK_ACTIVE_CHANNELS.MAX.WARN}'
          value: '28'
          description: 'The maximum number of busy channels of a trunk for trigger expression.'
        -
          macro: '{$AMI.TRUNK_ACTIVE_CHANNELS_TOTAL.MAX.WARN:"IAX"}'
          value: '28'
          description: 'The total maximum number of busy channels of IAX trunks for trigger expression.'
        -
          macro: '{$AMI.TRUNK_ACTIVE_CHANNELS_TOTAL.MAX.WARN:"PJSIP"}'
          value: '28'
          description: 'The total maximum number of busy channels of PJSIP trunks for trigger expression.'
        -
          macro: '{$AMI.TRUNK_ACTIVE_CHANNELS_TOTAL.MAX.WARN:"SIP"}'
          value: '28'
          description: 'The total maximum number of busy channels of SIP trunks for trigger expression.'
        -
          macro: '{$AMI.TRUNK_REGEXP}'
          value: trunk
          description: 'The regexp for the identification of trunk peers.'
      dashboards:
        -
          uuid: a8ca6e69633642aba6c9d90b21610ac6
          name: 'Asterisk Dashboard'
          pages:
            -
              widgets:
                -
                  type: GRAPH_CLASSIC
                  width: '8'
                  height: '3'
                  fields:
                    -
                      type: GRAPH
                      name: graphid
                      value:
                        name: 'Asterisk: PJSIP peers'
                        host: 'Template Tel Asterisk-FreePBX by Agent-Active'
                -
                  type: GRAPH_CLASSIC
                  'y': '3'
                  width: '8'
                  height: '3'
                  fields:
                    -
                      type: GRAPH
                      name: graphid
                      value:
                        name: 'Asterisk: SIP peers'
                        host: 'Template Tel Asterisk-FreePBX by Agent-Active'
                -
                  type: GRAPH_CLASSIC
                  'y': '6'
                  width: '8'
                  height: '3'
                  fields:
                    -
                      type: GRAPH
                      name: graphid
                      value:
                        name: 'Asterisk: IAX peers'
                        host: 'Template Tel Asterisk-FreePBX by Agent-Active'
                -
                  type: GRAPH_CLASSIC
                  x: '8'
                  width: '9'
                  height: '3'
                  fields:
                    -
                      type: GRAPH
                      name: graphid
                      value:
                        name: 'Asterisk: Calls stats'
                        host: 'Template Tel Asterisk-FreePBX by Agent-Active'
      valuemaps:
        -
          uuid: d6e38832f2d44ec0bf6761e36fd7668f
          name: 'Service state'
          mappings:
            -
              value: '0'
              newvalue: Down
            -
              value: '1'
              newvalue: Up
  graphs:
    -
      uuid: 92b561a0aee24da9a7d9875f2293316d
      name: 'Asterisk: Calls stats'
      graph_items:
        -
          color: 1A7C11
          item:
            host: 'Template Tel Asterisk-FreePBX by Agent-Active'
            key: asterisk.active_channels
        -
          sortorder: '1'
          color: 2774A4
          item:
            host: 'Template Tel Asterisk-FreePBX by Agent-Active'
            key: asterisk.active_calls
        -
          sortorder: '2'
          color: F63100
          yaxisside: RIGHT
          item:
            host: 'Template Tel Asterisk-FreePBX by Agent-Active'
            key: asterisk.calls_processed.rate
    -
      uuid: 9c6ed2110beb417bbaf2e300074690a2
      name: 'Asterisk: IAX peers'
      graph_items:
        -
          color: 1A7C11
          item:
            host: 'Template Tel Asterisk-FreePBX by Agent-Active'
            key: asterisk.iax.active_channels
        -
          sortorder: '1'
          color: 2774A4
          item:
            host: 'Template Tel Asterisk-FreePBX by Agent-Active'
            key: asterisk.iax.online
        -
          sortorder: '2'
          color: F63100
          item:
            host: 'Template Tel Asterisk-FreePBX by Agent-Active'
            key: asterisk.iax.offline
        -
          sortorder: '3'
          color: A54F10
          item:
            host: 'Template Tel Asterisk-FreePBX by Agent-Active'
            key: asterisk.iax.unmonitored
    -
      uuid: 106cbfaff8be4e8bb39e05a489ae58e7
      name: 'Asterisk: PJSIP peers'
      graph_items:
        -
          color: 1A7C11
          item:
            host: 'Template Tel Asterisk-FreePBX by Agent-Active'
            key: asterisk.pjsip.active_channels
        -
          sortorder: '1'
          color: 2774A4
          item:
            host: 'Template Tel Asterisk-FreePBX by Agent-Active'
            key: asterisk.pjsip.available
        -
          sortorder: '2'
          color: F63100
          item:
            host: 'Template Tel Asterisk-FreePBX by Agent-Active'
            key: asterisk.pjsip.unavailable
    -
      uuid: 4bb3ad80895e40d4a4a75b5d8a00117c
      name: 'Asterisk: SIP peers'
      graph_items:
        -
          color: 1A7C11
          item:
            host: 'Template Tel Asterisk-FreePBX by Agent-Active'
            key: asterisk.sip.active_channels
        -
          sortorder: '1'
          color: 2774A4
          item:
            host: 'Template Tel Asterisk-FreePBX by Agent-Active'
            key: asterisk.sip.monitored_online
        -
          sortorder: '2'
          color: F63100
          item:
            host: 'Template Tel Asterisk-FreePBX by Agent-Active'
            key: asterisk.sip.monitored_offline
        -
          sortorder: '3'
          color: A54F10
          item:
            host: 'Template Tel Asterisk-FreePBX by Agent-Active'
            key: asterisk.sip.unmonitored_online
        -
          sortorder: '4'
          color: FC6EA3
          item:
            host: 'Template Tel Asterisk-FreePBX by Agent-Active'
            key: asterisk.sip.unmonitored_offline
